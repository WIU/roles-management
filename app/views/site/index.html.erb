<%= javascript_include_tag params[:controller] %>

<div style="float: right; clear: both; margin: 0.5em; margin-top: -1em;">
  <select class="styled">
  	<optgroup label="Subordinates">
  		<option>View As ...</option>
  		<% current_user.subordinates.each do |person| %>
	      <option><%= person.name %></option>
	    <% end %>
  	</optgroup>
  </select>
</div> <!-- block -->

<div style="clear: both;"></div>

<div class="block span-80 left">
	<div class="block_head">
		<div class="bheadl"></div>
		<div class="bheadr"></div>

		<h2>Manage</h2>
	</div>		<!-- .block_head ends -->
	
	<div class="block_content">
	  
	  <% current_user.applications.each do |app| %>
      <script type="text/javascript">
      site.applications[<%= app.id %>] = <%= app.to_json.html_safe %>;
      </script>
	    <div class="card" data-represents-application="<%= app.id %>">
  	    <div class="card_head">
  	      <div class="bheadl"></div>
      		<div class="bheadr"></div>

  	      <h2><%= app.display_name %></h2>
  	    </div>
  	    <div class="card_content">
  	      <p>
  	        <i>“<%= app.description %>”</i>
  	      </p>

          <div class="pins">
            <div class="placeholder"><img src="/assets/add.png" alt="" /></div>
          </div>
  	    </div> <!-- card_content -->
      	<div class="bendl"></div>
      	<div class="bendr"></div>
  	  </div> <!-- card -->
	  <% end %>
  
	</div>		<!-- .block_content ends -->
	
	<div class="bendl"></div>
	<div class="bendr"></div>
</div>

<div class="block span-20 right">
	<div class="block_head">
		<div class="bheadl"></div>
		<div class="bheadr"></div>

		<ul class="tabs" style="float: none; margin-left: 35px;">
			<li><a href="#groups">Groups</a></li>
			<li><a href="#people">People</a></li>
		</ul>
	</div>		<!-- .block_head ends -->
	
	<div class="block_content tab_content" id="groups">
	  <ul class="pins">
	    <% current_user.owns.each do |group| %>
	      <li data-pin-type="group" data-pin-value="<%= group.id %>"><%= group.name %></li>
	    <% end %>
		</ul>
    <% if current_user.owns.count == 0 %>
    <li>You have no groups.</li>
    <% end %>
	</div>		<!-- .block_content .tab_content ends -->

	<div class="block_content tab_content" id="people">
	  <ul class="pins">
	    <% current_user.subordinates.each do |person| %>
      <li data-pin-type="person" data-pin-value="<%= person.id %>"><%= person.name %></li>
      <% end %>
    </ul>
    <% if current_user.subordinates.count == 0 %>
    <i>You have no subordinates.</i>
    <% end %>
	</div>		<!-- .block_content .tab_content ends -->
	
	<div class="bendl"></div>
	<div class="bendr"></div>
</div>

<script type="text/javascript">
  // Construct the initial pin layout
  
  // Groups
  <% current_user.owns.each do |group| %>
    <% group.roles.each do |role| %>
      site.add_pin( <%= role.to_json.html_safe %>, <%= group.to_json.html_safe %> )
    <% end %>
  <% end %>

  // People
  <% current_user.subordinates.each do |person| %>
    <% person.roles.each do |role| %>
      site.add_pin( <%= role.to_json.html_safe %>, <%= person.to_json.html_safe %> )
    <% end %>
  <% end %>
</script>
