<div class="row-fluid">
  <div class="span9">
    
    <form class="form-search">
      <input placeholder="Search applications…" type="text" class="input-xxlarge search-query">
    </form>
    
    <% current_user.manageable_applications.each_with_index do |app, i| %>
    <script type="text/javascript">
      site.applications[<%= app.id %>] = <%= app.to_json.html_safe %>;
      site.current_user_id = <%= current_user.id %>;
    </script>
    <div class="card" data-application="<%= app.to_json %>" data-application-id="<%= app.id %>">
      <h3 class="card-title"><%= app.display_name %></h3>
      <div class="card-content">
        <div class="pins"></div>
      </div>
	  </div> <!-- card -->
  <% end %>
  
  </div> <!-- /.span9 -->
  <div class="span3">
    
    <form class="form-search">
      <input placeholder="Search people and groups…" type="text" class="input-large search-query">
    </form>
    
	  <ul class="pins"></ul>
  </div> <!-- /.span3 -->
</div>

<%= javascript_include_tag params[:controller] %>
<%= javascript_include_tag "details_modal" %>

<script type="text/javascript">
// Construction availbility list
<% current_user.owns.each do |group| %>
  site.add_to_available_list(<%= group.to_json.html_safe %>);
<% end %>
<% current_user.subordinates.each do |person| %>
  site.add_to_available_list(<%= person.to_json.html_safe %>);
<% end %>

// Construct the initial pin layout
// Groups
<% current_user.owns.each do |group| %>
  <% group.roles.each do |role| %>
    site.register_role( <%= group.to_json.html_safe %>, <%= role.to_json.html_safe %>, true )
  <% end %>
<% end %>

// People
<% current_user.subordinates.each do |person| %>
  <% person.roles.each do |role| %>
    site.register_role( <%= person.to_json.html_safe %>, <%= role.to_json.html_safe %>, true )
  <% end %>
<% end %>
</script>
